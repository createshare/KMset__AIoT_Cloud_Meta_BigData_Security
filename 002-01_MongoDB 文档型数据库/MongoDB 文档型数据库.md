[TOC]

# MongoDB 文档型数据库

MongoDB 是一个非关系型、分布式文件存储的数据库，主要由 C++ 语言编写。

MongoDB 为 Web 开发提供了可扩展、高性能、易使用的数据存储方案。

MongoDB 作为面向文档的数据库，查询语言非常强大，支持存储比较复杂的数据类型，并支持动态查询、索引、复制、故障恢复、存储的文件格式为 BSON（JSON 的扩展）。

# MongoDB（非关系型）与 MySQL（关系型数据库）

在 MySQL（关系型数据库）中，数据是以表的形式存储的，每个表均由纵向的列和横向的行组成，表与表之间又有关联关系。

MongoDB（非关系型数据库）以文档的形式来存储数据，存储结构为 BSON 格式。

特别是在项目初期，如果业务需求还不太明确，且字段定义不清时，可以使用非关系型数据库 MongoDB 进行数据存储。

MongoDB 中也可以建立文档与文档的关联关系，这种关联关系类似于 MySQL（关系型数据库）中的一对一、一对多、多对多的关系。

MongoDB 中可以通过内嵌文档的形式或引用文档的 _id 字段建立关系。



# MongoDB 基础概念

## 文档（document）

文档是 MongoDB 中存储数据的基本单元，主要以键值对的形式存在。

### 文档的定义

- MongoDB 区分类型、区分大小写。
- 文档中可以包含多种不同的数据类型，但键值中不能包含 \0（空字符），不能包含特殊意义的字符（. 和 $）。
- 文档中的键值不能重复。
- 文档中的键值对是有序的。

### 数据类型

MongoDB 中支持的常用数据类型有 null、布尔类型、数值 、字符串、数组、对象 id、日期、正则表达式。

## 集合（collection）

MongoDB 中的集合是由一组文档组成的，如果把文档看作关系型数据库中行数据，则集合类似于关系型数据库中表的概念。

集合的使用需要注意：

- 集合是动态模式。动态模式意味着文档中存储的结构，可以是各式各样的。
- 集合的命名，不能包含 \0 字符（空字符）、不能以 “system.” 开头、不能包含保留字符 $。
- 集合中可以放置任何文档，文档中的键值对，可以各不相同。



## 数据库（database）

在 MongoDB 中，多个文档组成集合，多个集合组成数据库。

一个 MongoDB 实例中可以承载多个数据库，每个数据库中可以拥有 0 个或多个集合，每一个数据库都可以设置独立的权限。

数据库的使用注意事项：

- 数据库的命名基本上只能使用 ASCII 中的数字和字母，数据库名区分大小写，且最多为 64 字节。
- MongoDB 中有默认的 admin、local、config 数据库。
- 将数据库名加在集合前，就可以得到命名空间（namespace）。



# MongoDB 数据库语法

## 查看、创建、删除数据库

- MongoDB 中默认的数据为 test，如果在没有新建数据库的情况下，创建集合，则集合默认被存放在 test 数据库中。
- 查看当前使用的数据库，输入命令：db
- 查看已经创建的数据库，输入命令：show dbs
- 创建数据库，并切换到指定的数据库，输入命令：use DATABASE_NAME
- 删除数据库，输入命令：db.dropDatabase()
- MongoDB 数据库默认开启的端口号：27017



## 查看、创建、删除集合

- 查看集合，输入命令：show collections
- 创建集合，输入命令：db.createCollection(name, options)
  - name：表示集合的名称
  - options：表示可选参数，用于指定有关内存大小和索引选项。
- 删除集合，输入命令：db.COLLECTION_NAME.drop()
- 在 MongoDB 中，可以不用手动创建集合。当向集合中插入文档时，MongoDB 会自动创建集合。

## 插入、查询、删除、修改文档

- 插入文档，输入命令：db.COLLECTION_NAME.insert(document)
- 指插入文档，输入命令：db.COLLECTION_NAME.batchInsert()
- 查询文档，输入命令：
  - 返回一个集合中文档的子集：db.COLLECTION_NAME.find()  
    - find() 和 find({}) 方法都用于查询所有的文档。
    - 如果不指定查询条件或不使用 {} ，则表示查询集合中的全部内容。默认情况下 {} 可能不写。
    - 通过 find({}) 可以添加查询条件。
  - 返回符合查询条件的第一个结果：db.COLLECTION_NAME.findOne()
- 删除文档，输入命令：db.COLLECTION_NAME.remove()
  - 如果需要删除所有的文档，可以使用 remove({}) 方法，该命令只删除集合中的所有文档信息，但不会删除集合本身。
  - 如果需要删除满足条件的文档，可以用 remove() 方法，接收删除条件。例如，删除 age 为 18 的文档，删除语句为 db.student.remove({'age':18})
- 修改（更新）文档，输入命令：db.COLLECTION_NAME.update()



## 索引

索引类似于书籍的目录，查询书中的内容时，不必去翻书的每一页，只需要先查询目录，从目录定位到书籍中内容的位置。

使用索引能够提高数据库查询的效率。

两种数据查询方式：

- 第一种：全表检索：不添加任何索引。如果想查询数据库中某张表的内容，就需要查找完整的表。
- 第二种：添加索引。
  - 创建索引，输入命令：db.COLLECTION_NAME.createIndex({key: value})
    - key：为创建索引的字段
    - value： 为 1 表示按照升序创建索引；为 -1 表示按照降序创建索引。

MongoDB 的索引几乎和关系型数据库的索引一模一样，虽然建立索引能够优化查询的效率，但索引并不是越多越好，合理建立索引才是优化查询性能的关键。
