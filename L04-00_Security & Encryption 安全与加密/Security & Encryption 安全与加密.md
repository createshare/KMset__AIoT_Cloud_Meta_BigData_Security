# Security & Encryption 安全与加密



# 密码学相关概念

密码学主要分为：编制密码、破译密码。密码学需要通过算法，提供信息的隐秘传递方式，它包括一些通信架构和
加密算法等部分。



## 密码

通信的时候双端进行信息变换和保密的方法，主要包括加密变换和脱密变换。

随着技术的发展，文字、图形、语音、图像和数据都可以进行密码变换。

根据加密方式的不同，密码的种类包括：

- 对称密码。主要有 3 种：DES、三重 DES、AES（Advanced Encryption Standard）
- 分组密码。通过密码迭代的方式，对任意长度明文进行加密，DES 和 AES 都属于分组密码。主要包括 5 种模式：ECB 模式、CTR 模式、CBC 模式、OFB 模式、CFB 模式。
- 公钥密码。主要解决了密钥输送问题，它通过公钥加密，通过私钥解密，不需要接收者接收配送的密钥。公钥和私钥必须一一对应，称为密钥对，它们之间具有密切的数学联系，无法单独生成。公钥发送给其他人，私钥只有自己握有。RSA 算法是常用的公钥密码算法。
- 混合密码。它是一种结合对称密码和公钥密码的方案，它可以提高对称密码的速度，并且使用公钥密码保护会话层。

## 认证

认证是密码学的重要组成部分，是对消息进行确认完整性和合法性的技术，一般通过发送者和接收者的密钥，识别信息的非法伪装和私自篡改等问题。

它通过密码认证协议 PAP,允许用户信息传输权限。

它确认了网络活动中用户可以获取信息的范围。它会使用消息认证码和认证函数，与密钥息息相关。

认证经常使用单向散列函数和消息认证码进行处理。

- 单向散列函数，通过输入值和输出值处理验证问题。输入的是消息，输出的是消息的散列值。
- 常用的单向散列函数在开发过程中会用到，例如，MD4、MD5、SHA-128、SHA-256、SHA-512等。SHA-256 哈希算法，成为区块链“探矿”的主要算法。
- 消息认证码。它是一种认证完整性的技术，简称 MAC（Message Authentication Code），是一种和密钥共同动作的单向散列函数。

## 数字签名

数字签名的作用是为了证明某段数据或者文件是某人的权益，从而进行签名，具有不可伪造、不可抵赖的特性。

在许多网络信息和金融交易当中，需要对某段数据或者交易进行证明，表示它的所属人员，这个时候就需要数字签名。

数字签名需要密码技术来保证其不被篡改，并且可以通过密钥生成和验证签名。

数字签名常用的方式是使用公钥加密系统，常用的算法包括：

- RSA 算法。基于对大整数进行质因数分解非常困难的原理。
- DSA 算法。基于离散对数原理。
- ECDSA 算法。DSA 的变化版本，基于椭圆曲线的离散对数原理。ECDSA 通过椭圆对称算法，使用 SHA-256 进行加密计算，其实也是一种 DSA 的算法过程。在区块链中，比特币的账户就是通过 ECDSA 进行加密的。

## 证书颁发机构 CA（certification authority）

CA是第三方机构，被你信任，由它保证证书的确发给了应该得到该证书的人。CA自己有一个庞大的public key数据库，用来颁发给不同的实体。CA也是一个实体，它也有自己的公共密钥和私有密钥。

证书颁发机构（CA）是一个值得信赖的第三方的机构（所有者），其证书值得信任。

最常见的解决方案是借助证书颁发机构（CA）做这项工作（如下图） ：在浏览器中指定哪些CA是可信任（根CA证书），CA负责验证你访问的每个网站，并进行审核，以确认这些证书没有被滥用或受损害。如果任何网站违反了CA的证书的安全性规定，那么CA有责任撤销其证书。

![证书颁发机构（CA）](figures/证书颁发机构（CA）.jpg)

## 证书撤销名单（CRL）

**证书撤销名单（CRL）**：每个证书颁发机构维护并定期发布一份吊销证书序列号列表。要想验证证书的可靠性，直接查询CRL名单即可。

CRL文件本身可以定期公布，或在每次更新时都公布，CRL文件可以通过HTTP，或任何其他文件传输协议传输。该名单也是由CA签名，通常允许以指定的时间间隔缓存。

偶尔证书的颁发机构可能需要撤销或作废证书，这可能由于证书的私钥被攻破了，证书颁发机构本身被攻破，或者其他一些正常的原因譬如证书替换、证书签发机构发生变化，等等。为了解决这个问题，证书本身包含了检查是否已吊销的逻辑。因此，为了确保信任链不会受到攻击影响，每个节点都可以检查每个证书的状态，连同签名。

## 证书 Certificate 

证书是建立公共密钥和某个实体之间联系的数字化的文件。它包含的内容有：版本信息（X.509也是有三个版本的）、系列号、证书接受者名称、颁发者名称、证书有效期、公共密钥、一大堆的可选的其他信息、CA的数字签名。证书由CA颁发，由CA决定该证书的有效期，由该CA签名。每个证书都有唯一的系列号。证书的系列号和证书颁发者来决定某证书的唯一身份。常用的证书是采用X.509结构的，这是一个国际标准证书结构。



证书是在公钥的基础上进行数字签名，可以用来判断公钥的合法性，保障不受外部的非法攻击，它一般由认证机构来签名认证。即通过签发证书机构在证书中进行数字签名以后再发放给用户，用户可以通过证书进行机构所给权限的活动。

主要使用公钥和数字来加密，也称为公钥证书。

证书的签名和验证流程：

![证书的签名和验证流程](figures/证书的签名和验证流程.jpg)

### 证书的结构具有标准规范：

- 签名证书：包含了签名的对象数据。
- 签名算法：对证书签名使用的密码算法。
- 数字签名：证书使用的数字签名对象。

机构发放证书有一系列的规范，总称为 PKI。例如，证书在区块链的联盟链中用于处理成员授权，主要包括：

- 用户：全名用证书 PKI　的人或者机构。
- 认证机构：发放证书的人或者机构（认证中心）
- 仓库：存储证书的数据库。

### 证书中包含什么信息

- 证书信息：过期时间和序列号
- 所有者信息：姓名等
- 所有者公钥

### 为什么服务端要发送证书给客户端

- 互联网有太多的服务需要使用证书来验证身份，以至于客户端(操作系统或浏览器等)无法内置所有证书，需要通过服务端将证书发送给客户端。

### 客户端为什么要验证接收到的证书：

- 中间人攻击

- 客户端<----------------------攻击者<--------------------服务端

  ​                 伪造证书                         拦截请求



### 客户端如何验证接收到的证书

为了回答这个问题，需要引入数字签名(Digital Signature)。

将一段文本通过哈希(hash)和私钥加密处理后生成数字签名。

- 假设消息传递在Bob，Susan和Pat三人之间发生。Susan将消息连同数字签名一起发送给Bob，Bob接收到消息后，可以这样验证接收到的消息就是Susan发送的。
- 当然，这个前提是Bob知道Susan的公钥。更重要的是，和消息本身一样，公钥不能在不安全的网络中直接发送给Bob。
- 此时就引入了证书颁发机构(Certificate Authority，简称CA)，CA数量并不多，Bob客户端内置了所有受信任CA的证书。CA对Susan的公钥(和其他信息)数字签名后生成证书。
- Susan将证书发送给Bob后，Bob通过CA证书的公钥验证证书签名。
- Bob信任CA，CA信任Susan， 使得 Bob信任Susan，信任链(Chain Of Trust)就是这样形成的。
- 事实上，Bob客户端内置的是CA的根证书(Root Certificate)，HTTPS协议中服务器会发送证书链(Certificate Chain)给客户端。

# 加密算法

## 对称加密

对称加密：指加密和解密使用相同密钥的加密算法。对称加密算法的优点在于加解密的高速度和使用长密钥时的难破解性。
常见的对称加密算法：DES、3DES、DESX、AES、RC4、RC5、RC6等。

## 非对称加密

非对称加密：指加密和解密使用不同密钥的加密算法，也称为公私钥加密。
常见的非对称加密算法：RSA、DSA（数字签名用）等。

## Hash算法

Hash算法：Hash算法它是一种单向算法，用户可以通过Hash算法对目标信息生成一段特定长度的唯一的Hash值，却不能通过这个Hash值逆向获得目标信息。
常见的Hash算法：MD2、MD4、MD5、SHA、SHA-1等。





# AES 对称加密

AES（Advanced Encryption Standard）采用 Rijndael 的加密算法，使用 SPN 作为基本网络结构，其密钥长度规范有3种: 128 比特、192 比特、256 比特。



# 公钥与私钥

公钥密码。主要解决了密钥输送问题，它通过公钥加密，通过私钥解密，不需要接收者接收配送的密钥。公钥和私钥必须一一对应，称为密钥对，它们之间具有密切的数学联系，无法单独生成。公钥发送给其他人，私钥只有自己握有。RSA、ECDSA 算法是常用的公钥密码算法。

公钥和私钥主要应用在非对称加密算法中。

公钥是公开的密码，应用在各个加密部分。公钥可以在网络上公开。

私钥是自己掌握的密钥，主要用来数据解密。

例如，在区块链的资产当中，私钥保护着用户所有的数字资产，用户最好保证私钥处于封闭的环境中，不在网络中流通，防止网络黑客。


