# Embedded Linux 嵌入式操作系统

## 嵌入式 Linux 操作系统

Linux是一套免费使用和自由传播的类Unix操作系统，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统。它能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。并且使用GNU 工程各种工具和数据库的操作系统。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。

Linux 作为开源免费操作系统，以其作为系统的应用可以较方便的进行系统功能的裁剪和跨体系结构移植。

在不同的目标体系结构下（x86，ARM，PowerPC，etc.），由于汇编指令集的不同，同一段代码利用不同的编译器和库文件生成的可执行代码是不同的。不同体系的 Linux 其开发工具是不同的。

嵌入式 Linux 属于高度裁剪过的 Linux，他将桌面 Linux 所具有的大部分应用功能（如 GUI 工具，计算器，电子邮件 etc.）和部分系统功能省略，但集成了开发者希望嵌入式产品所具有的特殊应用功能（比如 一款以 Linux 为系统的触摸式海事导航仪可以根据功能需要去除不需要的功能块，但加入 GPS 定位，航速航向计算，航线规划，触摸检测和对应功能实现等功能）。

嵌入式系统往往是指系统的资源（如，DRAM，FLASH，ROM，功耗，工作频率 etc.）有较大限制且系统的工作环境相对多变和恶劣（如温湿度变化大，酸碱度腐蚀，外部撞击和振动，外部电磁干扰，静电导致的高压损坏电路 etc.）。这也就需要开发人员更多的发现和假想可能的突发情况并采取相应预防措施。大部分嵌入式系统对响应的时间限制和正确性也有极高的要求。

嵌入式系统是在有限的空间和有限的资源中运行，高效地实现某种特定功能或功能集合的装置。它的开发通常受到很多客观条件的限制，诸如较弱的CPU处理能力、较小的内存空间、较少的可供选择的外设、有限的电源供应等。每个嵌入式系统的开发无不是精打细算，以求用有限的资源发挥最大的功效。

在各种嵌入式系统上运行的操作系统中，嵌入式 Linux 以其免费、高可靠性、广泛的硬件支持以及开放源码等众多特性正在获得越来越多的关注。其源码开放特性使得开发者可以针对特定的嵌入式系统对 Linux 内核进行修改，以满足开发要求，达到系统最优化的目的。

嵌入式 Linux 应用中的一大问题是 Linux 的实时性问题。实时系统必须在限定时间内对外部事件作出正确响应，重点放在对满足突发性、暂时性的处理需求上。而 Linux 作为传统的分时操作系统，关注更多的是系统的整体数据吞吐量。如何提高 Linux 的实时性能是摆在广大嵌入式系统级开发人员面前的挑战。

## 嵌入式 Linux 和桌面 Linux 的区别



- 硬件平台
  - 嵌入式 Linux一般是 Mips，ARM 平台。例如，ARM9 这些芯片，主频慢，存储空间小，所以要对 Linux 进行裁减。
  - 普通桌面 Linux 一般是 x86 平台，CPU 性能要够高，内存硬盘都够大。
- 实时性
  - 嵌入式 Linux 需要为实时优化
- 根文件系统
  - 嵌入式 Linux 一般用 UBIFS、yaffs2、jffs2。
  - 桌面 Linux 一般用 ext3、ext4。
- shell 不一样
  - 嵌入式 Linux 一般用 busybox。
  - 桌面 Linux 一般用 bash。

## 常用的嵌入式 Linux

国内对于uClinux和RT-Linux研究的较多。

### EEOS

Easy Embedded OS（简称 EEOS）红旗嵌入式Linux，由北京中科院红旗软件公司推出的嵌入式Linux是国内做得较好的一款嵌入式操作系统。目前，中科院计算所自行开发的开放源码的嵌入式操作系统——Easy Embedded OS（EEOS）也已经开始进入实用阶段了。该款嵌入式操作系统重点支持p-Java。系统目标一方面是小型化，另一方面能重用Linux的驱动和其它模块。由于有中科院计算所的强大科研力量做后盾，EEOS有望发展成为功能完善、稳定、可靠的国产嵌入式操作系统平台。

### RT-Linux

由美国墨西哥理工学院开发的嵌入式Linux操作系统。由于其独有的任务调度实时性，到目前为止，RT-Linux已经成功地应用于航天飞机的空间数据采集、科学仪器测控和电影特技图像处理等广泛领域。RT-Linux开发者并没有针对实时操作系统的特性而重写Linux的内核，因为这样做的工作量非常大，而且要保证兼容性也非常困难。为此，RT-Linux提出了精巧的内核，并把标准的Linux核心作为实时核心的一个进程，同用户的实时进程一起调度。这样对Linux内核的改动非常小，并且充分利用了Linux下现有的丰富的软件资源。
RT-Linux 是一个基于 Linux 的硬实时系统，它采用双内核的设计方法，此后的 RTAI 和 Xenomai（Xenomai 3.x 的 Mercury 核除外） 也是采用双内核的设计方法。

RT-Linux，已经用在工业控制等很多方面。

### μClinux

μCLinux（micro-control Linux，即微控制器领域中的 Linux 系统）是由嵌入式 Linux 行业主要厂商之一 Lineo 公司推出的。同时也是开放源码的嵌入式Linux的典范之作。μCLinux主要是针对目标处理器没有存储管理单元 MMU（Memory Management Unit）的嵌入式系统而设计的。它已经被成功地移植到了很多平台上。由于没有MMU，其多任务的实现需要一定技巧。μCLinux是一种优秀的嵌入式Linux版本，是micro-Conrol-Linux的缩写。它秉承了标准Linux的优良特性， 经过各方面的小型化改造，形成了一个高度优化的、代码紧凑的嵌入式Linux。虽然它的体积很小，却仍然保留了Linux的大多数的优点：稳定、良好的移植性、优秀的网络功能、对各种文件系统完备的支持和标准丰富的API。它专为嵌入式系统做了许多小型化的工作，目前已支持多款CPU。 其编译后目标文件可控制在几百KB数量级，并已经被成功地移植到很多平台上。



### XLinux

XLinux是由美国网虎公司推出，主要开发者是陈盈豪。他在加盟网虎几个月后便开发出了基于XLinux的、号称是世界上最小的嵌入式Linux系统，内核只有143KB，而且还在不断减小。XLinux核心采用了“超字元集”专利技术，让Linux核心不仅可能与标准字符集相容，还含盖了12个国家和地区的字符集。因此，XLinux在推广Linux的国际应用方面有独特的优势。

### Embedix

Embedix是由嵌入式Linux行业主要厂商之一Luneo推出的，是根据嵌入式应用系统的特点重新设计的Linux发行版本。Embedix提供了超过25种的Linux系统服务，包括Web服务器等。系统需要最小8MB内存，3MB ROM或快速闪存。Embedix基于Linux 2.2内核，并已经成功地移植到了Intel x86和PowerPC处理器系列上。像其它的Linux版本一样，Embedix可以免费获得。Luneo还发布了另一个重要的软件产品，它可以让在Windows CE上运行的程序能够在Embedix上运行。Luneo还将计划推出Embedix的开发调试工具包、基于图形界面的浏览器等。可以说，Embedix是一种完整的嵌入式Linux解决方案。

### PoketLinux

PoketLinux由Agenda公司采用、作为其新产品“VR3 PDA”的嵌入式Linux操作系统。它可以提供跨操作系统构造统一的、标准化的和开放的信息通信基础结构，在此结构上实现端到端方案的完整平台。PoketLinux资源框架开放，使普通的软件结构可以为所有用户提供一致的服务。PoketLinux平台使用户的视线从设备、平台和网络上移开，由此引发了信息技术新时代的产生。在PoketLinux中，称之为用户化信息交换（CIE），也就是提供和访问为每个用户需求而定制的“主题”信息的能力，而不管正在使用的设备是什么。

### MidoriLinux

由Transmeta公司推出的MidoriLinux操作系统代码开放，在GUN普通公共许可（GPL）下发布，可以在http://midori.transmeta.com上立即获得。该公司有个名为“MidoriLinux计划”。“MidoriLinux”这个名字来源于日本的“绿色”——Midori，用来反映其Linux操作系统的环保外观。



# RT-Linux



# uClinux

## 硬件的支持、资源占用

在对硬件的支持上，由于μClinux继承了Linux的大部分性能，所以至少需要512KB的RAM空间，lMB的ROM／Flash空间。

在μClinux的移植方面，μClinux是Linux针对嵌入式系统的一种改良，其结构比较复杂。移植μClinux，目标处理器除了需要修改与处理器相关的代码外，还需要足够容量的外部ROM和RAM。



## 进程任务管理

μClinux在结构上继承了标准Linux的多任务实现方式，分为实时进程和普通进程，分别采用先来先服务和时间片轮转调度，仅针对中低档嵌入式CPU特点进行改良，且不支持内核抢占，实时性一般。

## 内存管理

在内存管理上由于μClinux是针对没有MMU的处理器设计的，不能使用处理器的虚拟内存管理技术，只能采用实存储器管理策略。系统使用分页内存分配方式，在启动时对实际存储器进行分页。系统对内存的访问是直接的，操作系统对内存空间没有保护，多个进程可共享一个运行空间，所以，即使是一个无特权进程调用一个无效指针也会触发一个地址错误，并有可能引起程序崩溃甚至系统崩溃。

μClinux最大特点在于针对无MMU处理器设计，这对于没有MMU功能的stm32f103来说是合适的，但移植此系统需要至少512KB的RAM空间，1MB的ROM/FLASH空间，而stmf103拥有256K的FLASH，需要外接存储器，这就增加了硬件设计的成本。

## 中断管理

μClinux操作系统的中断管理是将中断处理分为两部分：顶半处理和底半处理。在顶半处理中，必须关中断运行，且仅进行必要的、非常少、速度快的处理，其他处理交给底半处理；底半处理执行那些复杂、耗时的处理，而且接受中断。因为系统中存在有许多中断的底半处理，所以会引起系统中断处理的延时。

## 文件系统

μClinux对文件系统支持良好，由于μClinux继承了Linux完善的文件系统性能，它支持ROMFS、NFS、ext2、MS-DOS、JFFS等文件系统。但一般采用ROMFS文件系统，这种文件系统相对于一般的文件系统(如ext2)占用更少的空间。但是ROMFS文件系统不支持动态擦写保存，对于系统需要动态保存的数据须采用虚拟RAM盘／JFFS的方法进行处理。





![XXX](figures/XXX.jpg)



